<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; margin:0; padding:0; background:#0d1117; color:#c9d1d9; }
.container { width: 100%; max-width: 400px; margin:auto; padding: 10px; }
video { width: 100%; border-radius: 10px; }
input, button { width: 100%; margin:5px 0; }
</style>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
<div class="container">
<h2>Welcome {{ session.user }}</h2>

<form action="/upload" method="POST" enctype="multipart/form-data">
  <input type="file" name="reel" required>
  <button type="submit">Upload Reel</button>
</form>

{% for reel in reels %}
  <div class="reel">
    <video controls>
      <source src="{{ reel.filename }}">
    </video>
    <p>{{ reel.likes }} Likes <a href="/like/{{ reel.id }}">üëç</a></p>
    <form method="POST" action="/comment/{{ reel.id }}">
      <input name="comment" placeholder="Add comment..." required>
      <button type="submit">Comment</button>
    </form>
    {% for c in reel.comments %}
      <p><strong>{{ c.username }}:</strong> {{ c.content }}</p>
    {% endfor %}
  </div>
{% endfor %}

<h3>Real-time Chat</h3>
<div id="chatbox" style="border:1px solid #ccc; height:150px; overflow-y:scroll;"></div>
<input id="msg" placeholder="Type message">
<button onclick="sendMessage()">Send</button>

<script>
const socket = io();
function sendMessage(){
  const msg = document.getElementById('msg').value;
  socket.emit("send_message", {user:"{{ session.user }}", message: msg});
  document.getElementById('msg').value = "";
}
socket.on("receive_message", function(data){
  const chatbox = document.getElementById("chatbox");
  chatbox.innerHTML += "<p><strong>"+data.user+":</strong> "+data.message+"</p>";
  chatbox.scrollTop = chatbox.scrollHeight;
});
</script>

</div>
</body>
</html>
